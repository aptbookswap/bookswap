<div class="col-md-4 mb-4" data-publicacion-id="{{ publicacion.id_publicacion }}">
  <div class="card position-relative">
    {% if publicacion.imagenes.all %}
    <img src="{{ publicacion.imagenes.all.0.imagen.url }}" class="card-img-top" alt="Imagen publicaci칩n">
    {% endif %}
    <div class="dropdown position-absolute top-0 end-0 m-2">
      <button class="btn btn-sm btn-light dropdown-toggle" type="button" data-bs-toggle="dropdown">
        <i class="fas fa-ellipsis-v"></i>
      </button>
      <ul class="dropdown-menu dropdown-menu-end">
        <li><a class="dropdown-item" href="{% url 'detalle_publicacion' publicacion.id_publicacion %}">Ver Detalles</a></li>
      </ul>
    </div>
    <div class="card-body text-center">
      <h5 class="card-title">{{ publicacion.libro.titulo }}</h5>
      <p class="card-text">
        {{ publicacion.descripcion|linebreaksbr }}<br>
        Tipo: <strong>{{ publicacion.tipo_transaccion|title }}</strong><br>
        {% if publicacion.tipo_transaccion == "venta" %}
        Valor: ${{ publicacion.valor }}
        {% endif %}
      </p>
      <span class="badge bg-secondary">{{ publicacion.estado_publicacion|title }}</span>

      {# Confirmar En Proceso #}
      {% if publicacion.estado_publicacion == 'en_espera' and publicacion.user_ofertador == request.user %}
      <button class="btn btn-success btn-sm mt-2"
              onclick="cambiarEstadoAEnProceso('{{ publicacion.id_publicacion }}')">
        Confirmar En Proceso
      </button>
      {% endif %}

      {# Cancelar publicaci칩n #}
      {% if publicacion.estado_publicacion == 'en_espera' or publicacion.estado_publicacion == 'en_proceso' %}
        {% if request.user == publicacion.user_ofertador or request.user == publicacion.user_comprador %}
        <button class="btn btn-danger btn-sm mt-2"
                onclick="cancelarPublicacion('{{ publicacion.id_publicacion }}')">
          Cancelar Publicaci칩n
        </button>
        {% endif %}
      {% endif %}

      {# Volver a publicar si est치 cancelado #}
      {% if publicacion.estado_publicacion == 'cancelado' and publicacion.user_ofertador == request.user %}
      <button class="btn btn-primary btn-sm mt-2"
              onclick="volverADisponible('{{ publicacion.id_publicacion }}')">
        Volver a Publicar
      </button>
      {% endif %}
    </div>
  </div>
</div>
